services:
  autonom-app:
    build: .
    container_name: autonom_agent
    ports:
      - "8000:8000"
    volumes:
      # Syncs local code changes to the container immediately
      - .:/app
      # Persist the SQLite DB so data survives restarts
      - ./src/db:/app/src/db
    # We override the CMD from the Dockerfile to add the '--reload' flag
    command: uvicorn src.server:app --host 0.0.0.0 --port 8000 --reload
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      # - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - DOORDASH_API_URL=http://dashdoor:8001
    depends_on:
      - dashdoor 

  # Mock Service (Commented out for Phase 1)
  dashdoor:
    build: 
      context: .
      dockerfile: ./dashdoor/Dockerfile
    container_name: doordash_service
    ports:
      - "8001:8001"
    volumes:
      # Syncs local code to container for hot reloading
      - ./dashdoor:/app
      # Mount shared utils directory
      - ./utils:/app/utils
    # Override the command to enable reloading
    command: uvicorn main:app --host 0.0.0.0 --port 8001 --reload